
{% extends "match_history/base.html" %}
{% load static  %}
{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'match_history/css/details.css' %}">
{% endblock %}


{% block content %}
<div class="summoner-header">
    <div class="summoner-card">
        <div class="profile-icon-container">
            <img class="main-icon" src="{{summoner.profile_icon.get_url}}" alt="" >
            <div class="level">
                {{summoner.summoner_level}}
            </div>
        </div>
        <div class="summoner-name">
            <p class="large-text">{{summoner.game_name}} <span id="tag">#{{summoner.tag_line}}</span></p>
            <button id = "update">Update</button>
        </div>
    </div>
</div>
<div class="main-info">
    <div class="sidebar">
        <div class="account-container section">
            <div class="section-header">
                <div class="title">Account Summary</div>
                <div class="year">2024</div>
            </div>
            <hr>
            <div class="account-card">
                <div class="account-aram">ARAM</div>
                <div class="stat-section stats-text sub-text">
                    <div class="champ-kda"> {{account_stats.kda}} </div>
                    <div class="kda"> {{account_stats.kills}} / {{account_stats.deaths}} / {{account_stats.assists}} </div>
                </div>
                <div class=" total-played">
                    <div class="winrate">{{account_stats.winrate}}</div>
                    <div class="total-played">{{account_stats.total_played}} games</div>
                </div>
            </div>

        </div>
        <div class="snowball-container section">
            <div class="section-header">
                <div class="title">Snowballs</div>
                <div class="year">2024</div>
            </div>
            <hr>
            <div class="snowball-content">
                <div class="icon-med">
                    <img src="https://ddragon.leagueoflegends.com/cdn/14.16.1/img/spell/SummonerSnowball.png" alt="" class="champ-img">
                </div>
                <div class="snowball-wrapper">
                    <div class="snowballs">{{account_stats.snowballs_hitrate}} </div>
                    <div class="thrown">{{account_stats.snowballs_thrown}} thrown</div>
                </div>
            </div>

        </div>
        <div class="champion-container section">
            <div class="section-header">
                <div class="title">Champions Played</div>
                <div class="year">2024</div>
            </div>
            <hr>
            <div class="champ-list">
                {% for champ, stats in champion_stats%}
                    <div class="champ-card">
                        <div class="icon-med">
                            <img class="champ-img" src="{{champ.get_url}}" alt="">
                        </div>
                        <div class="champs-text">
                            <div class="div">{{champ.name}}</div>
                            <div class="stat-section stats-text sub-text">
                                <div class="champ-kda">{{stats.kda}}</div>
                                <div class="kda">{{stats.kills}} / {{stats.deaths}} / {{stats.assists}}</div>
                            </div>
                            <div class=" total-played">
                                <div class="winrate">{{stats.winrate}}</div>
                                <div class="total-played">{{stats.total_played}} games</div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="recent-container section">
            <div class="section-header">
                <div class="title">Recently Played</div>
                <div class="year sub-text">(last {{recent_list.0}} games)</div>
            </div>
            <hr>
            <div class="recent-list">
            
                {% for participant in recent_list.1 %}
                <div class="recent-card">
                    <div class="recent-info">
                        <div class="icon-med">
                            <img class="champ-img" src="{{participant.participant.profile_icon.get_url}}" alt="">
                        </div>
                        <div class="account-info">
                            <div class="recent-name"><a href ="{{participant.participant.get_url}}">{{participant.participant.get_full_name}}</a></div>
                            <div class="recent-level sub-text">level {{participant.participant.summoner_level}}</div>
                        </div>
                    </div>
                    <div class="recent-stats">
                        <div class="win-loss">{{participant.total_wins}}W / {{participant.total_losses}}L</div>
                    </div>
                    <div class="recent-wr">
                        {{participant.winrate}}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="match-history section">
        Match History
        <hr>
        <div id="match-list" data-total-pages ={{ total_pages }}>

            {% include "match_history/match_list.html"%}
            
        </div>
    </div>
</div>

{% endblock content %}
{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    console.log("hey")
    let page = 2;  // Start from the second page
    let loading = false;
    let noMorePages = false;
    console.log("hey")
    let totalPages = Number($('#match-list').data('total-pages'));
    console.log("Total Pages: " + totalPages);
    $(window).scroll(function() {
        // Check if the user has scrolled near the bottom and we have more pages to load
        if (page <= totalPages && $(window).scrollTop() + $(window).height() >= $(document).height() - 100 && !loading && !noMorePages) {
            loading = true;

            $.ajax({
                url: window.location.href,
                data: {
                    'page': page
                },
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(data) {
                    // If there are no more pages of data, set noMorePages to true
                    if (data.trim() === '' || page > totalPages) {
                        noMorePages = true;
                    } else {
                        console.log("hey ye")
                        console.log("Page loaded");
                        $('#match-list').append(data);  // Append the new data

                        // Add the "done" element after loading the page
                        $('#match-list').append('<div class="done">Done with this page</div>');

                        page += 1;  // Increment the page
                    }
                    loading = false;
                },
                error: function() {
                    loading = false;
                }
            });
        }

        // Stop sending requests if we've reached the last page
        if (page > totalPages) {
            noMorePages = true;
        }
    });

</script>


{% endblock %}