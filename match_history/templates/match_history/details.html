
{% extends "match_history/base.html" %}
{% load static  %}
{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'match_history/css/details.css' %}">
{% endblock %}


{% block content %}
<div class="summoner-header">
    <div class="summoner-card">
        <div class="profile-icon-container">
            <img class="main-icon" src="{{summoner.profile_icon.get_url}}" alt="" >
            <div class="level">
                {{summoner.summoner_level}}
            </div>
        </div>
        <div class="summoner-name">
            <p class="large-text">{{summoner.game_name}} <span id="tag">#{{summoner.tag_line}}</span></p>
            <button id = "update">Update</button>
        </div>
    </div>
</div>
<div class="main-info">
    <div class="sidebar">
        <div class="Account-container section">
            Account
            <hr>

        </div>
        <div class="Account-container section">
            Snowball Hits
            <hr>

        </div>
        <div class="Account-container section">
            Champions
            <hr>

        </div>
    </div>
    <div class="match-history section">
        Match History
        <div id="match-list" data-total-pages ={{ total_pages }}>

            {% include "match_history/match_list.html"%}
            
           <p>done</p>
        </div>
    </div>
</div>

{% endblock content %}
{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    console.log("hey")
    let page = 2;  // Start from the second page
    let loading = false;
    let noMorePages = false;
    console.log("hey")
    let totalPages = Number($('#match-list').data('total-pages'));
    console.log("Total Pages: " + totalPages);
    $(window).scroll(function() {
        // Check if the user has scrolled near the bottom and we have more pages to load
        if (page <= totalPages && $(window).scrollTop() + $(window).height() >= $(document).height() - 100 && !loading && !noMorePages) {
            loading = true;

            $.ajax({
                url: window.location.href,
                data: {
                    'page': page
                },
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(data) {
                    // If there are no more pages of data, set noMorePages to true
                    if (data.trim() === '' || page > totalPages) {
                        noMorePages = true;
                    } else {
                        console.log("hey ye")
                        console.log("Page loaded");
                        $('#match-list').append(data);  // Append the new data

                        // Add the "done" element after loading the page
                        $('#match-list').append('<div class="done">Done with this page</div>');

                        page += 1;  // Increment the page
                    }
                    loading = false;
                },
                error: function() {
                    loading = false;
                }
            });
        }

        // Stop sending requests if we've reached the last page
        if (page > totalPages) {
            noMorePages = true;
        }
    });

</script>


{% endblock %}